import{s as r}from"./supabaseClient-8CxNeXQr.js";import{i as C}from"./roles-CRsL3K8t.js";document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("main-navbar"),g=document.getElementById("nav-dashboard"),y=document.getElementById("nav-admin"),v=document.getElementById("nav-home-item"),h=document.getElementById("nav-login-item"),f=document.getElementById("nav-register-item"),p=document.getElementById("nav-logout-item"),B=document.getElementById("logoutBtn"),E=document.getElementById("authForm"),I=document.getElementById("formTitle"),n=document.getElementById("submitBtn"),c=document.getElementById("toggleModeBtn"),w=document.getElementById("toggleText"),o=document.getElementById("alertArea");let s=!0;async function L(){var l;const{data:{session:e},error:t}=await r.auth.getSession();!t&&!!e&&((l=e==null?void 0:e.user)!=null&&l.id)?(v.style.display="block",g.style.display="block",y.style.display=await C(e.user.id)?"block":"none",h.style.display="none",f.style.display="none",p.style.display="block",i&&i.classList.remove("navbar-guest-mode")):(v.style.display="none",g.style.display="none",y.style.display="none",h.style.display="block",f.style.display="block",p.style.display="none",i&&i.classList.add("navbar-guest-mode"))}L(),B&&B.addEventListener("click",async e=>{e.preventDefault();const{error:t}=await r.auth.signOut();t?d("Failed to log out.","danger"):window.location.href="../../index.html"});function b(){s?(I.textContent="Login",n.textContent="Login",w.textContent="Don't have an account?",c.textContent="Register here"):(I.textContent="Register",n.textContent="Register",w.textContent="Already have an account?",c.textContent="Login here")}new URLSearchParams(window.location.search).get("mode")==="register"&&(s=!1),b();function d(e,t){o.textContent=e,o.className=`alert alert-${t} mt-3`,o.classList.remove("d-none")}function x(){o.classList.add("d-none"),o.textContent=""}c.addEventListener("click",e=>{e.preventDefault(),s=!s,b(),x(),E.reset()}),E.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value,m=document.getElementById("password").value,l=n.textContent;n.disabled=!0,n.textContent="Processing...",x();try{if(s){const{data:u,error:a}=await r.auth.signInWithPassword({email:t,password:m});if(a)throw a;d("Login successful! Redirecting...","success"),setTimeout(()=>{window.location.href="../../index.html"},1e3)}else{const{data:u,error:a}=await r.auth.signUp({email:t,password:m});if(a)throw a;d("Registration successful! Redirecting...","success"),setTimeout(()=>{window.location.href="../../index.html"},1e3)}}catch(u){d(u.message,"danger"),n.disabled=!1,n.textContent=l}})});
