import{s}from"./supabaseClient-DBugF8ZN.js";document.addEventListener("DOMContentLoaded",async()=>{const B=document.getElementById("logoutBtn"),C=document.getElementById("createPromptBtn"),L=document.getElementById("searchPrompts"),m=document.getElementById("promptsLoading"),l=document.getElementById("promptsContainer"),i=document.getElementById("promptsEmpty"),T=document.getElementById("categoryTitle"),{data:{session:_},error:M}=await s.auth.getSession();if(M||!_){window.location.href="../login/login.html";return}const u=document.getElementById("user-email");let g=null;if(u){const{data:{user:e},error:t}=await s.auth.getUser();if(t||!e){window.location.href="../login/login.html";return}g=e,e.email&&(u.textContent=e.email)}const a=new URLSearchParams(window.location.search).get("category");let d=[];async function k(){const e=document.getElementById("promptCategorySelect");try{const{data:t,error:n}=await s.from("categories").select("*").order("name",{ascending:!0});if(n)throw n;t.forEach(o=>{const r=document.createElement("option");r.value=o.id,r.textContent=o.name,a&&o.id===a&&(r.selected=!0,T.textContent=`Prompts: ${o.name}`),e.appendChild(r)})}catch(t){console.error("Error fetching categories:",t.message)}}async function c(){try{m.style.display="block",l.style.display="none",i.style.display="none";let e=s.from("prompts").select("*, categories(name)").order("created_at",{ascending:!1});a&&(e=e.eq("category_id",a));const{data:t,error:n}=await e;if(n)throw n;d=t,p(d)}catch(e){console.error("Error fetching prompts:",e.message),m.style.display="none",i.style.display="block",i.innerHTML='<h5 class="text-danger">Failed to load prompts.</h5>'}}function p(e){m.style.display="none",e.length===0?(l.style.display="none",i.style.display="block"):(i.style.display="none",l.style.display="flex",l.innerHTML="",e.forEach(t=>{var r;const n=((r=t.categories)==null?void 0:r.name)||"Uncategorized",o=document.createElement("div");o.className="col-12 mb-4",o.innerHTML=`
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0">${t.title}</h5>
              </div>
              <p class="card-text text-muted small">Category: ${n}</p>
              <div class="mb-3">
                <strong>Prompt:</strong>
                <p class="bg-light p-2 rounded border" style="white-space: pre-wrap;">${t.prompt_text}</p>
              </div>
              ${t.result_text?`
              <div class="mb-3">
                <strong>Result:</strong>
                <div class="bg-light p-2 rounded border" style="white-space: pre-wrap;">${t.result_text}</div>
              </div>
              `:""}
              <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm view-prompt-btn" data-id="${t.id}">View Details</button>
                <button class="btn btn-outline-danger btn-sm delete-prompt-btn" data-id="${t.id}">Delete</button>
              </div>
            </div>
          </div>
        `,l.appendChild(o)}),document.querySelectorAll(".view-prompt-btn").forEach(t=>{t.addEventListener("click",n=>{const o=n.currentTarget.getAttribute("data-id"),r=e.find(F=>F.id===o);r&&$(r)})}),document.querySelectorAll(".delete-prompt-btn").forEach(t=>{t.addEventListener("click",async n=>{if(confirm("Are you sure you want to delete this prompt?")){const o=n.currentTarget.getAttribute("data-id");try{const{error:r}=await s.from("prompts").delete().eq("id",o);if(r)throw r;c()}catch(r){console.error("Error deleting prompt:",r.message),alert("Failed to delete prompt.")}}})}))}k(),c(),B.addEventListener("click",async e=>{e.preventDefault();const{error:t}=await s.auth.signOut();t?(console.error("Error logging out:",t.message),alert("Failed to log out.")):window.location.href="../../index.html"});const y=new window.bootstrap.Modal(document.getElementById("addPromptModal")),S=document.getElementById("savePromptBtn"),f=document.getElementById("promptCategorySelect"),h=document.getElementById("promptTitle"),v=document.getElementById("promptText"),w=document.getElementById("promptResult");C.addEventListener("click",()=>{h.value="",v.value="",w.value="",a&&(f.value=a),y.show()}),S.addEventListener("click",async()=>{const e=h.value.trim(),t=v.value.trim(),n=w.value.trim(),o=f.value;if(!e||!t||!o){alert("Please fill in the required fields (Category, Title, and Prompt Text).");return}try{const{error:r}=await s.from("prompts").insert([{title:e,prompt_text:t,result_text:n,category_id:o,user_id:g.id}]);if(r)throw r;y.hide(),c(),alert("Prompt saved successfully!")}catch(r){console.error("Error creating prompt:",r.message),alert("Failed to create prompt: "+r.message)}});const E=new window.bootstrap.Modal(document.getElementById("viewPromptModal")),q=document.getElementById("updatePromptBtn"),I=document.getElementById("editPromptId"),P=document.getElementById("editPromptTitle"),b=document.getElementById("editPromptText"),x=document.getElementById("editPromptResult");function $(e){I.value=e.id,P.value=e.title,b.value=e.prompt_text,x.value=e.result_text||"",E.show()}q.addEventListener("click",async()=>{const e=I.value,t=P.value.trim(),n=b.value.trim(),o=x.value.trim();if(!t||!n){alert("Please fill in the required fields (Title and Prompt Text).");return}try{const{error:r}=await s.from("prompts").update({title:t,prompt_text:n,result_text:o}).eq("id",e);if(r)throw r;E.hide(),c(),alert("Prompt updated successfully!")}catch(r){console.error("Error updating prompt:",r.message),alert("Failed to update prompt: "+r.message)}}),L.addEventListener("input",e=>{const t=e.target.value.toLowerCase();if(!t){p(d);return}const n=d.filter(o=>o.title.toLowerCase().includes(t)||o.prompt_text.toLowerCase().includes(t)||o.result_text&&o.result_text.toLowerCase().includes(t));p(n)})});
