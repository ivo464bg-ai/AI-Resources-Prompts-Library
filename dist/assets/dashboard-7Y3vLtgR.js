import{s as l}from"./supabaseClient-DBugF8ZN.js";document.addEventListener("DOMContentLoaded",async()=>{const M=document.getElementById("logoutBtn"),C=document.getElementById("createCategoryBtn"),_=document.getElementById("addPromptBtn"),g=document.getElementById("categoriesLoading"),d=document.getElementById("categoriesList"),m=document.getElementById("categoriesEmpty"),y=document.getElementById("promptsLoading"),p=document.getElementById("promptsContainer"),u=document.getElementById("promptsEmpty"),{data:{session:q},error:A}=await l.auth.getSession();if(A||!q){window.location.href="../login/login.html";return}const f=document.getElementById("user-email");if(f){const{data:{user:e},error:r}=await l.auth.getUser();if(r||!e){window.location.href="../login/login.html";return}e.email&&(f.textContent=e.email)}M.addEventListener("click",async e=>{e.preventDefault();const{error:r}=await l.auth.signOut();r?(console.error("Error logging out:",r.message),alert("Failed to log out.")):window.location.href="../../index.html"});let i=null;async function h(){try{g.style.display="block",d.style.display="none",m.style.display="none";const{data:e,error:r}=await l.from("categories").select("*").order("created_at",{ascending:!1});if(r)throw r;if(g.style.display="none",e.length===0)m.style.display="block";else{d.style.display="block",d.innerHTML="";const a=document.createElement("li");a.className="nav-item mb-1",a.innerHTML=`
          <a class="nav-link text-dark bg-white border rounded py-2 px-3 category-link ${i===null?"active-category":""}" href="#" data-id="">
            üìÅ All Categories
          </a>
        `,d.appendChild(a),e.forEach(t=>{const o=document.createElement("li");o.className="nav-item mb-1",o.innerHTML=`
            <a class="nav-link text-dark bg-white border rounded py-2 px-3 category-link ${i===t.id?"active-category":""}" href="#" data-id="${t.id}">
              üìÅ ${t.name}
            </a>
          `,d.appendChild(o)}),document.querySelectorAll(".category-link").forEach(t=>{t.addEventListener("click",o=>{o.preventDefault(),document.querySelectorAll(".category-link").forEach(s=>s.classList.remove("active-category")),o.currentTarget.classList.add("active-category");const n=o.currentTarget.getAttribute("data-id");i=n||null,c()})})}}catch(e){console.error("Error fetching categories:",e.message),g.style.display="none",m.style.display="block",m.innerHTML='<small class="text-danger">Failed to load categories.</small>'}}async function c(){try{y.style.display="block",p.style.display="none",u.style.display="none";let e=l.from("prompts").select("*, categories(name)").order("created_at",{ascending:!1});i&&(e=e.eq("category_id",i));const{data:r,error:a}=await e;if(a)throw a;y.style.display="none",r.length===0?u.style.display="block":(p.style.display="flex",p.innerHTML="",r.forEach(t=>{var s;const o=((s=t.categories)==null?void 0:s.name)||"Uncategorized",n=document.createElement("div");n.className="col",n.innerHTML=`
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h5 class="card-title">${t.title}</h5>
                <h6 class="card-subtitle mb-2 text-muted">üìÅ ${o}</h6>
                <p class="card-text text-truncate">${t.prompt_text}</p>
              </div>
              <div class="card-footer bg-transparent border-top-0 d-flex justify-content-between">
                <button class="btn btn-sm btn-outline-primary view-prompt-btn" data-id="${t.id}">View Details</button>
                <button class="btn btn-sm btn-outline-danger delete-prompt-btn" data-id="${t.id}">Delete</button>
              </div>
            </div>
          `,p.appendChild(n)}),document.querySelectorAll(".view-prompt-btn").forEach(t=>{t.addEventListener("click",o=>{const n=o.currentTarget.getAttribute("data-id"),s=r.find(S=>S.id===n);s&&N(s)})}),document.querySelectorAll(".delete-prompt-btn").forEach(t=>{t.addEventListener("click",async o=>{if(confirm("Are you sure you want to delete this prompt?")){const n=o.currentTarget.getAttribute("data-id");try{const{error:s}=await l.from("prompts").delete().eq("id",n);if(s)throw s;c()}catch(s){console.error("Error deleting prompt:",s.message),alert("Failed to delete prompt.")}}})}))}catch(e){console.error("Error fetching prompts:",e.message),y.style.display="none",u.style.display="block",u.innerHTML='<h5 class="text-danger">Failed to load prompts.</h5>'}}h(),c();const E=new window.bootstrap.Modal(document.getElementById("createCategoryModal")),$=document.getElementById("saveCategoryBtn"),v=document.getElementById("categoryName");C.addEventListener("click",()=>{v.value="",E.show()}),$.addEventListener("click",async()=>{const e=v.value.trim();if(!e){alert("Please enter a category name.");return}try{const{data:{user:r},error:a}=await l.auth.getUser();if(a||!r)throw new Error("User not authenticated");const{error:t}=await l.from("categories").insert([{name:e,user_id:r.id}]);if(t)throw t;E.hide(),h()}catch(r){console.error("Error creating category:",r.message),alert("Failed to create category: "+r.message)}});const w=new window.bootstrap.Modal(document.getElementById("addPromptModal")),F=document.getElementById("savePromptBtn"),b=document.getElementById("promptTitle"),I=document.getElementById("promptText"),B=document.getElementById("promptResult");_.addEventListener("click",()=>{if(!i){alert("Please select a category first to add a prompt.");return}b.value="",I.value="",B.value="",w.show()}),F.addEventListener("click",async()=>{const e=b.value.trim(),r=I.value.trim(),a=B.value.trim();if(!e||!r){alert("Please fill in the required fields (Title and Prompt Text).");return}try{const{data:{user:t},error:o}=await l.auth.getUser();if(o||!t)throw new Error("User not authenticated");const{error:n}=await l.from("prompts").insert([{title:e,prompt_text:r,result_text:a,category_id:i,user_id:t.id}]);if(n)throw n;w.hide(),c(),alert("Prompt saved successfully!")}catch(t){console.error("Error creating prompt:",t.message),alert("Failed to create prompt: "+t.message)}});const x=new window.bootstrap.Modal(document.getElementById("viewPromptModal")),H=document.getElementById("updatePromptBtn"),P=document.getElementById("editPromptId"),L=document.getElementById("editPromptTitle"),k=document.getElementById("editPromptText"),T=document.getElementById("editPromptResult");function N(e){P.value=e.id,L.value=e.title,k.value=e.prompt_text,T.value=e.result_text||"",x.show()}H.addEventListener("click",async()=>{const e=P.value,r=L.value.trim(),a=k.value.trim(),t=T.value.trim();if(!r||!a){alert("Please fill in the required fields (Title and Prompt Text).");return}try{const{error:o}=await l.from("prompts").update({title:r,prompt_text:a,result_text:t}).eq("id",e);if(o)throw o;x.hide(),c(),alert("Prompt updated successfully!")}catch(o){console.error("Error updating prompt:",o.message),alert("Failed to update prompt: "+o.message)}})});
