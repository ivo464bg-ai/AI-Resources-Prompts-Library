import{s as i}from"./supabaseClient-8CxNeXQr.js";/* empty css               */import{i as ut}from"./roles-BbqFL7ZG.js";document.addEventListener("DOMContentLoaded",async()=>{function j(e){var a;const t=document.getElementById(e);return!t||!((a=window.bootstrap)!=null&&a.Modal)?null:new window.bootstrap.Modal(t)}const I=document.getElementById("main-navbar"),N=document.getElementById("logoutBtn"),V=document.getElementById("createPromptBtn"),Q=document.getElementById("searchPrompts"),z=document.getElementById("nav-home"),G=document.getElementById("nav-categories"),J=document.getElementById("nav-explore"),K=document.getElementById("nav-dashboard"),W=document.getElementById("nav-prompts"),X=document.getElementById("nav-admin"),Y=document.getElementById("nav-login"),Z=document.getElementById("nav-register"),tt=document.getElementById("nav-logout"),et=document.getElementById("nav-user-email"),x=document.getElementById("nav-divider"),H=document.getElementById("promptsLoading"),u=document.getElementById("promptsContainer"),p=document.getElementById("promptsEmpty"),lt=document.getElementById("categoryTitle"),{data:{session:st},error:it}=await i.auth.getSession(),d=!it&&!!st,nt=document.getElementById("user-email");let s=null;if(d&&nt){const{data:{user:e},error:t}=await i.auth.getUser();!t&&e&&(s=e),e!=null&&e.email&&(nt.textContent=e.email)}if(d){const e=await ut(s==null?void 0:s.id);z.style.display="block",G.style.display="block",J.style.display="block",K.style.display="block",W.style.display="block",X.style.display=e?"block":"none",Y.style.display="none",Z.style.display="none",tt.style.display="block",et.style.display="block",x&&x.style.setProperty("display","flex","important"),I&&I.classList.remove("navbar-guest-mode")}else z.style.display="block",G.style.display="block",J.style.display="block",K.style.display="none",W.style.display="none",X.style.display="none",Y.style.display="block",Z.style.display="block",tt.style.display="none",et.style.display="none",x&&x.style.setProperty("display","none","important"),I&&I.classList.add("navbar-guest-mode"),V.style.display="none";const ot=new URLSearchParams(window.location.search),c=ot.get("category"),O=ot.get("search");let g=[],P={};async function dt(){const e=document.getElementById("promptCategorySelect");try{let t=i.from("categories").select("*").order("name",{ascending:!0});d&&(s!=null&&s.id)&&(t=t.eq("user_id",s.id));const{data:a,error:o}=await t;if(o)throw o;a.forEach(n=>{const r=document.createElement("option");r.value=n.id,r.textContent=n.name,c&&n.id===c&&(r.selected=!0,lt.textContent=`Prompts: ${n.name}`),e.appendChild(r)})}catch(t){console.error("Error fetching categories:",t.message)}}async function y(){try{H.style.display="block",u.style.display="none",p.style.display="none";let e=i.from("prompts").select("*, categories(name)").order("created_at",{ascending:!1});d&&(s!=null&&s.id)&&(e=e.eq("user_id",s.id)),c&&(e=e.eq("category_id",c));const{data:t,error:a}=await e;if(a)throw a;g=t;const o=[];if(t.forEach(n=>{n.file_url&&n.file_url.match(/\.(jpeg|jpg|gif|png|webp)$/i)&&o.push(n.file_url)}),P={},o.length>0){const{data:n,error:r}=await i.storage.from("prompt-attachments").createSignedUrls(o,3600);!r&&n&&n.forEach(l=>{l.error||(P[l.path]=l.signedUrl)})}if(O){Q.value=O;const n=O.toLowerCase(),r=g.filter(l=>l.title.toLowerCase().includes(n)||l.prompt_text.toLowerCase().includes(n)||l.result_text&&l.result_text.toLowerCase().includes(n));B(r)}else B(g)}catch(e){console.error("Error fetching prompts:",e.message),H.style.display="none",p.style.display="block",p.innerHTML='<h5 class="text-danger">Failed to load prompts.</h5>'}}function B(e){H.style.display="none",e.length===0?(u.style.display="none",p.style.display="block"):(p.style.display="none",u.style.display="flex",u.innerHTML="",e.forEach(t=>{var l;const a=((l=t.categories)==null?void 0:l.name)||"Uncategorized",o=document.createElement("div");o.className="col-12 mb-4";let n="",r="";t.file_url&&(t.file_url.match(/\.(jpeg|jpg|gif|png|webp)$/i)&&P[t.file_url]?r+=`<img src="${P[t.file_url]}" class="card-img-top mb-2" alt="Attachment Preview" style="max-height: 150px; object-fit: cover;">`:n+=`<button class="btn btn-sm btn-outline-secondary view-attachment-btn mt-2 me-2" data-url="${t.file_url}">ðŸ“Ž View Attachment</button>`),o.innerHTML=`
          <div class="card shadow-sm">
            ${r?`<div class="p-2 d-flex flex-wrap gap-2">${r}</div>`:""}
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0">${t.title}</h5>
              </div>
              <p class="card-text text-muted small">Category: ${a}</p>
              <div class="mb-3">
                <strong>Prompt:</strong>
                <p class="bg-light p-2 rounded border" style="white-space: pre-wrap;">${t.prompt_text}</p>
              </div>
              ${t.result_text?`
              <div class="mb-3">
                <strong>Result:</strong>
                <div class="bg-light p-2 rounded border" style="white-space: pre-wrap;">${t.result_text}</div>
              </div>
              `:""}
              <div class="d-flex flex-wrap mb-3">
                ${n}
              </div>
              <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm view-prompt-btn" data-id="${t.id}">View Details</button>
                ${d?`<button class="btn btn-outline-danger btn-sm delete-prompt-btn" data-id="${t.id}">Delete</button>`:""}
              </div>
            </div>
          </div>
        `,u.appendChild(o)}),document.querySelectorAll(".view-attachment-btn").forEach(t=>{t.addEventListener("click",async a=>{const o=a.currentTarget.getAttribute("data-url"),{data:n,error:r}=await i.storage.from("prompt-attachments").createSignedUrl(o,3600);n?window.open(n.signedUrl,"_blank"):(console.error("Error getting signed URL:",r),alert("Failed to load attachment."))})}),document.querySelectorAll(".view-prompt-btn").forEach(t=>{t.addEventListener("click",a=>{const o=a.currentTarget.getAttribute("data-id"),n=e.find(r=>r.id===o);n&&ct(n)})}),d&&document.querySelectorAll(".delete-prompt-btn").forEach(t=>{t.addEventListener("click",async a=>{if(confirm("Are you sure you want to delete this prompt?")){const o=a.currentTarget.getAttribute("data-id");try{const n=e.find(l=>l.id===o);n&&n.file_url&&await i.storage.from("prompt-attachments").remove([n.file_url]);const{error:r}=await i.from("prompts").delete().eq("id",o);if(r)throw r;y()}catch(n){console.error("Error deleting prompt:",n.message),alert("Failed to delete prompt.")}}})}))}dt(),y(),N&&N.addEventListener("click",async e=>{e.preventDefault();const{error:t}=await i.auth.signOut();t?(console.error("Error logging out:",t.message),alert("Failed to log out.")):window.location.href="../../index.html"});const _=j("addPromptModal"),rt=document.getElementById("savePromptBtn"),L=document.getElementById("promptCategorySelect"),k=document.getElementById("promptTitle"),$=document.getElementById("promptText"),C=document.getElementById("promptResult"),A=document.getElementById("promptFile");d&&V.addEventListener("click",()=>{!_||!k||!$||!C||!A||!L||(k.value="",$.value="",C.value="",A.value="",c&&(L.value=c),_.show())}),rt&&rt.addEventListener("click",async()=>{if(!d||!(s!=null&&s.id)||!k||!$||!C||!L||!A)return;const e=k.value.trim(),t=$.value.trim(),a=C.value.trim(),o=L.value,n=A.files;if(!e||!t||!o){alert("Please fill in the required fields (Category, Title, and Prompt Text).");return}try{let r=null;if(n&&n.length>0){const m=n[0],U=m.name.split(".").pop(),R=`${Math.random().toString(36).substring(2,15)}.${U}`,D=`${s.id}/${R}`,{error:w}=await i.storage.from("prompt-attachments").upload(D,m);if(w)throw w;r=D}const{error:l}=await i.from("prompts").insert([{title:e,prompt_text:t,result_text:a,category_id:o,user_id:s.id,file_url:r}]);if(l)throw l;_&&_.hide(),y(),alert("Prompt saved successfully!")}catch(r){console.error("Error creating prompt:",r.message),alert("Failed to create prompt: "+r.message)}});const T=j("viewPromptModal"),M=document.getElementById("updatePromptBtn"),S=document.getElementById("editPromptId"),f=document.getElementById("editPromptOldFileUrl"),h=document.getElementById("editPromptTitle"),v=document.getElementById("editPromptText"),b=document.getElementById("editPromptResult"),E=document.getElementById("editPromptFile"),F=document.getElementById("currentAttachmentContainer"),q=document.getElementById("currentAttachmentsList");async function ct(e){if(!T||!S||!f||!h||!v||!b||!E||!M||!F||!q)return;const t=!d;S.value=e.id,f.value=e.file_url||"",h.value=e.title,v.value=e.prompt_text,b.value=e.result_text||"",E.value="",h.readOnly=t,v.readOnly=t,b.readOnly=t,E.disabled=t,M.style.display=t?"none":"inline-block",q.innerHTML="";let a=!1;if(e.file_url){a=!0;const{data:o,error:n}=await i.storage.from("prompt-attachments").createSignedUrl(e.file_url,3600),r=o?o.signedUrl:"#",l=document.createElement("li");l.className="mb-2 d-flex align-items-center",l.innerHTML=`
        <a href="${r}" target="_blank" class="me-2 text-truncate" style="max-width: 200px;">Attachment</a>
        ${t?"":`<button type="button" class="btn btn-sm btn-outline-danger remove-attachment-btn" data-id="${e.id}" data-url="${e.file_url}">Remove</button>`}
      `,q.appendChild(l)}a?(F.style.display="block",t||document.querySelectorAll(".remove-attachment-btn").forEach(o=>{o.addEventListener("click",mt)})):F.style.display="none",T.show()}async function mt(e){if(confirm("Are you sure you want to remove this attachment?")){const t=e.currentTarget.getAttribute("data-id"),a=e.currentTarget.getAttribute("data-url");try{const{error:o}=await i.storage.from("prompt-attachments").remove([a]);if(o)throw o;const{error:n}=await i.from("prompts").update({file_url:null}).eq("id",t);if(n)throw n;e.currentTarget.closest("li").remove(),q.children.length===0&&(F.style.display="none"),f.value="",alert("Attachment removed successfully!"),y()}catch(o){console.error("Error removing attachment:",o.message),alert("Failed to remove attachment: "+o.message)}}}M&&M.addEventListener("click",async()=>{if(!d||!(s!=null&&s.id)||!S||!f||!h||!v||!b||!E)return;const e=S.value,t=f.value,a=h.value.trim(),o=v.value.trim(),n=b.value.trim(),r=E.files;if(!a||!o){alert("Please fill in the required fields (Title and Prompt Text).");return}try{let l={title:a,prompt_text:o,result_text:n};if(r&&r.length>0){const U=r[0],R=U.name.split(".").pop(),D=`${Math.random().toString(36).substring(2,15)}.${R}`,w=`${s.id}/${D}`,{error:at}=await i.storage.from("prompt-attachments").upload(w,U);if(at)throw at;t&&await i.storage.from("prompt-attachments").remove([t]),l.file_url=w}const{error:m}=await i.from("prompts").update(l).eq("id",e);if(m)throw m;T&&T.hide(),y(),alert("Prompt updated successfully!")}catch(l){console.error("Error updating prompt:",l.message),alert("Failed to update prompt: "+l.message)}}),Q.addEventListener("input",e=>{const t=e.target.value.toLowerCase();if(!t){B(g);return}const a=g.filter(o=>o.title.toLowerCase().includes(t)||o.prompt_text.toLowerCase().includes(t)||o.result_text&&o.result_text.toLowerCase().includes(t));B(a)})});
