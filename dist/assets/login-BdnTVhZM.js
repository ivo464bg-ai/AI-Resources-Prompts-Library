import{s as l}from"./supabaseClient-8CxNeXQr.js";import{i as L}from"./roles-Dahpx40n.js";document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("nav-dashboard"),g=document.getElementById("nav-admin"),y=document.getElementById("nav-login-item"),h=document.getElementById("nav-register-item"),f=document.getElementById("nav-logout-item"),v=document.getElementById("logoutBtn"),p=document.getElementById("authForm"),B=document.getElementById("formTitle"),n=document.getElementById("submitBtn"),r=document.getElementById("toggleModeBtn"),w=document.getElementById("toggleText"),o=document.getElementById("alertArea");let s=!0;async function I(){var d;const{data:{session:t},error:e}=await l.auth.getSession();!e&&!!t&&((d=t==null?void 0:t.user)!=null&&d.id)?(u.style.display="block",g.style.display=await L(t.user.id)?"block":"none",y.style.display="none",h.style.display="none",f.style.display="block"):(u.style.display="none",g.style.display="none",y.style.display="block",h.style.display="block",f.style.display="none")}I(),v&&v.addEventListener("click",async t=>{t.preventDefault();const{error:e}=await l.auth.signOut();e?i("Failed to log out.","danger"):window.location.href="../../index.html"});function x(){s?(B.textContent="Login",n.textContent="Login",w.textContent="Don't have an account?",r.textContent="Register here"):(B.textContent="Register",n.textContent="Register",w.textContent="Already have an account?",r.textContent="Login here")}new URLSearchParams(window.location.search).get("mode")==="register"&&(s=!1),x();function i(t,e){o.textContent=t,o.className=`alert alert-${e} mt-3`,o.classList.remove("d-none")}function E(){o.classList.add("d-none"),o.textContent=""}r.addEventListener("click",t=>{t.preventDefault(),s=!s,x(),E(),p.reset()}),p.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("email").value,c=document.getElementById("password").value,d=n.textContent;n.disabled=!0,n.textContent="Processing...",E();try{if(s){const{data:m,error:a}=await l.auth.signInWithPassword({email:e,password:c});if(a)throw a;i("Login successful! Redirecting...","success"),setTimeout(()=>{window.location.href="../../index.html"},1e3)}else{const{data:m,error:a}=await l.auth.signUp({email:e,password:c});if(a)throw a;i("Registration successful! Redirecting...","success"),setTimeout(()=>{window.location.href="../../index.html"},1e3)}}catch(m){i(m.message,"danger"),n.disabled=!1,n.textContent=d}})});
