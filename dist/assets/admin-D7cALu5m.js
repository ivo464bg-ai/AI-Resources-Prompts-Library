import{s}from"./supabaseClient-8CxNeXQr.js";/* empty css               */import{i as j}from"./roles-BbqFL7ZG.js";document.addEventListener("DOMContentLoaded",async()=>{const p=document.getElementById("main-navbar"),N=document.getElementById("nav-home"),W=document.getElementById("nav-categories"),A=document.getElementById("nav-explore"),z=document.getElementById("nav-dashboard"),F=document.getElementById("nav-admin"),H=document.getElementById("nav-login"),O=document.getElementById("nav-register"),P=document.getElementById("nav-logout"),R=document.getElementById("nav-user-email"),f=document.getElementById("nav-divider"),U=document.getElementById("user-email"),g=document.getElementById("logoutBtn"),E=document.getElementById("stat-total-users"),h=document.getElementById("stat-total-prompts"),v=document.getElementById("stat-total-categories"),C=document.getElementById("moderationLoading"),e=document.getElementById("moderationTopScroll"),b=document.getElementById("moderationTopScrollInner"),o=document.getElementById("moderationTableWrapper"),w=document.getElementById("moderationRows"),r=document.getElementById("moderationEmpty");let m=!1,y=!1;function B(){if(!e||!b||!o)return;if(o.style.display==="none"){e.style.display="none";return}const t=o.querySelector("table");if(!t){e.style.display="none";return}b.style.width=`${t.scrollWidth}px`;const l=t.scrollWidth>o.clientWidth+1;if(e.style.display=l?"block":"none",!l){e.scrollLeft=0,o.scrollLeft=0;return}e.scrollLeft=o.scrollLeft}e&&o&&(e.addEventListener("scroll",()=>{y||(m=!0,o.scrollLeft=e.scrollLeft,m=!1)}),o.addEventListener("scroll",()=>{m||(y=!0,e.scrollLeft=o.scrollLeft,y=!1)}),window.addEventListener("resize",B));const{data:{session:i},error:q}=await s.auth.getSession(),M=!q&&!!i,d=(i==null?void 0:i.user)||null;if(!M||!(d!=null&&d.id)){window.location.href="../home/home.html";return}if(!await j(d.id)){window.location.href="../home/home.html";return}N.style.display="block",W.style.display="block",A.style.display="block",z.style.display="block",F.style.display="block",H.style.display="none",O.style.display="none",P.style.display="block",R.style.display="block",U.textContent=d.email||"",f&&f.style.setProperty("display","flex","important"),p&&p.classList.remove("navbar-guest-mode"),g&&g.addEventListener("click",async t=>{t.preventDefault();const{error:l}=await s.auth.signOut();l?alert("Failed to log out."):window.location.href="../../index.html"});function $(t){if(!t)return"-";const l=new Date(t);return Number.isNaN(l.getTime())?"-":l.toLocaleString()}async function I(){const{data:t,error:l}=await s.rpc("get_admin_dashboard_stats");if(l||!t||t.length===0){E.textContent="0",h.textContent="0",v.textContent="0";return}const n=t[0];E.textContent=n.total_users??0,h.textContent=n.total_prompts??0,v.textContent=n.total_categories??0}async function L(){C.style.display="block",e&&(e.style.display="none"),o.style.display="none",r.style.display="none";const{data:t,error:l}=await s.rpc("get_admin_prompts");if(C.style.display="none",l){r.textContent="Failed to load prompts.",r.style.display="block";return}if(!t||t.length===0){r.textContent="No prompts found.",r.style.display="block";return}w.innerHTML="",t.forEach(n=>{const a=document.createElement("tr"),x=document.createElement("td");x.textContent=n.title||"-";const _=document.createElement("td");_.textContent=n.category_name||"Uncategorized";const k=document.createElement("td");k.textContent=n.author_email||"-";const T=document.createElement("td");T.textContent=n.user_id||"-";const S=document.createElement("td");S.textContent=$(n.created_at);const D=document.createElement("td"),c=document.createElement("button");c.className="btn btn-sm btn-outline-danger",c.textContent="Delete",c.addEventListener("click",async()=>{if(window.confirm("Delete this prompt?"))try{n.file_url&&!/^https?:\/\//i.test(n.file_url)&&await s.storage.from("prompt-attachments").remove([n.file_url]);const{error:u}=await s.from("prompts").delete().eq("id",n.id);if(u)throw u;await I(),await L()}catch{alert("Failed to delete prompt.")}}),D.appendChild(c),a.appendChild(x),a.appendChild(_),a.appendChild(k),a.appendChild(T),a.appendChild(S),a.appendChild(D),w.appendChild(a)}),o.style.display="block",e&&B()}await I(),await L()});
