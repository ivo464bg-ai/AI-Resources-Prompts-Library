import{s as a}from"./supabaseClient-8CxNeXQr.js";import{i as S}from"./roles-Dahpx40n.js";document.addEventListener("DOMContentLoaded",async()=>{const _=document.getElementById("nav-dashboard"),k=document.getElementById("nav-admin"),L=document.getElementById("nav-login"),D=document.getElementById("nav-register"),T=document.getElementById("nav-logout"),A=document.getElementById("nav-user-email"),c=document.getElementById("nav-divider"),N=document.getElementById("user-email"),m=document.getElementById("logoutBtn"),u=document.getElementById("stat-total-users"),y=document.getElementById("stat-total-prompts"),p=document.getElementById("stat-total-categories"),g=document.getElementById("moderationLoading"),f=document.getElementById("moderationTableWrapper"),E=document.getElementById("moderationRows"),d=document.getElementById("moderationEmpty"),{data:{session:s},error:F}=await a.auth.getSession(),P=!F&&!!s,l=(s==null?void 0:s.user)||null;if(!P||!(l!=null&&l.id)){window.location.href="../home/home.html";return}if(!await S(l.id)){window.location.href="../home/home.html";return}_.style.display="block",k.style.display="block",L.style.display="none",D.style.display="none",T.style.display="block",A.style.display="block",N.textContent=l.email||"",c&&c.style.setProperty("display","flex","important"),m&&m.addEventListener("click",async e=>{e.preventDefault();const{error:n}=await a.auth.signOut();n?alert("Failed to log out."):window.location.href="../../index.html"});function R(e){if(!e)return"-";const n=new Date(e);return Number.isNaN(n.getTime())?"-":n.toLocaleString()}async function h(){const{data:e,error:n}=await a.rpc("get_admin_dashboard_stats");if(n||!e||e.length===0){u.textContent="0",y.textContent="0",p.textContent="0";return}const t=e[0];u.textContent=t.total_users??0,y.textContent=t.total_prompts??0,p.textContent=t.total_categories??0}async function C(){g.style.display="block",f.style.display="none",d.style.display="none";const{data:e,error:n}=await a.rpc("get_admin_prompts");if(g.style.display="none",n){d.textContent="Failed to load prompts.",d.style.display="block";return}if(!e||e.length===0){d.textContent="No prompts found.",d.style.display="block";return}E.innerHTML="",e.forEach(t=>{const o=document.createElement("tr"),w=document.createElement("td");w.textContent=t.title||"-";const v=document.createElement("td");v.textContent=t.category_name||"Uncategorized";const b=document.createElement("td");b.textContent=t.author_email||"-";const B=document.createElement("td");B.textContent=t.user_id||"-";const x=document.createElement("td");x.textContent=R(t.created_at);const I=document.createElement("td"),i=document.createElement("button");i.className="btn btn-sm btn-outline-danger",i.textContent="Delete",i.addEventListener("click",async()=>{if(window.confirm("Delete this prompt?"))try{t.file_url&&!/^https?:\/\//i.test(t.file_url)&&await a.storage.from("prompt-attachments").remove([t.file_url]);const{error:r}=await a.from("prompts").delete().eq("id",t.id);if(r)throw r;await h(),await C()}catch{alert("Failed to delete prompt.")}}),I.appendChild(i),o.appendChild(w),o.appendChild(v),o.appendChild(b),o.appendChild(B),o.appendChild(x),o.appendChild(I),E.appendChild(o)}),f.style.display="block"}await h(),await C()});
